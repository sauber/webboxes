[% BLOCK showlast %]
[% item.value.last %]
[% END %]

[% BLOCK show5last %]
[% SET to = item.value.max %]
[% SET from = to - 4 %]
[% SET from = 0 IF from < 0 %]
[% FOREACH n IN [ from  .. to ] %]
[% item.value.$n %]<br />
[% END %]
[% c.prototype.form_remote_tag( {
     update => rowid,
     url => base,
     evalScripts=>'true',
  } )
%]
[% END %]

[% BLOCK edit %]
<input name="[% item.fieldname %]" size="[% item.fieldsize %]" value="[% item.value | html %]" class="edititem">
[% END %]

[% BLOCK ajax %]
  [% idtag = id _ ' ' _ item.fieldname %]
  [% urlpart = [ 'project' 'ajax' listname 'field' id item.fieldname ] %]
  [% url = base _ urlpart.join('/') %]
  <span id="[% idtag %]" class="summary">
  [% IF item.value %]
    [% item.value %]
  [% ELSE %]
    <em>edit</em>
  [% END %]
  </span>
  [%
     c.prototype.in_place_editor( idtag, {
       'load_text_url' => url,
       'url' => url,
       'rows' => 1,
     } )
  %]
[% END %]

[% IF ( item.editsummary and context == 'summary' ) or ( item.editexpanded and conext == 'expanded' ) %]
  [% INCLUDE ajax %]
  [% RETURN %]
[% END %]

[% IF context == 'edit' %]
  [% INCLUDE edit %]
  [% RETURN %]
[% END %]

[% IF context == 'summary' %]
[% INCLUDE showlast %]
[% ELSIF context == 'expanded' %]
[% INCLUDE show5last %]
[% ELSIF context == 'edit' or context == 'show' %]
[% INCLUDE show20last %]
[% END %]

